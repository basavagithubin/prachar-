{% extends 'core/base.html' %}

{% block content %}
<div class="container mx-auto px-6 py-10 bg-gradient-to-br from-yellow-100 via-white to-orange-100 min-h-screen">
    <h2 class="text-4xl font-extrabold mb-10 text-center text-orange-800 font-serif drop-shadow-lg tracking-wide">
        📝 Candidate Comments Summary
    </h2>

    {% if grouped_comments %}
        {% for date, comments in grouped_comments.items %}
            {% with interested=0 not_interested=0 follow_up_later=0 other=0 %}
                {% for comment in comments %}
                    {% if comment.candidate.follow_up_status == "Interested" %}
                        {% with interested=interested|add:1 %}{% endwith %}
                    {% elif comment.candidate.follow_up_status == "Not Interested" %}
                        {% with not_interested=not_interested|add:1 %}{% endwith %}
                    {% elif comment.candidate.follow_up_status == "Follow-up Later" %}
                        {% with follow_up_later=follow_up_later|add:1 %}{% endwith %}
                    {% else %}
                        {% with other=other|add:1 %}{% endwith %}
                    {% endif %}
                {% endfor %}

                <div class="mb-8 rounded-xl shadow-lg border border-yellow-300 bg-white overflow-hidden">
                    <!-- Toggle Header -->
                    <button 
                        onclick="toggleComments('comments-{{ forloop.counter }}')"
                        class="w-full text-left flex justify-between items-center px-6 py-4 bg-yellow-200 hover:bg-yellow-300 transition-all duration-200"
                    >
                        <span class="text-xl font-semibold text-orange-900 tracking-wide">
                            {{ date }}
                        </span>
                        <span class="text-sm text-gray-700 font-medium">
                            🗂️ Total: {{ comments|length }} |
                            ✅ Interested: {{ interested }} |
                            ❌ Not Interested: {{ not_interested }} |
                            🔁 Follow-Up Later: {{ follow_up_later }} |
                            ❓ Other: {{ other }}
                        </span>
                    </button>

                    <!-- Comments Content -->
                    <div id="comments-{{ forloop.counter }}" class="hidden px-6 pb-6 bg-orange-50/30">
                        <ul class="space-y-6 pt-6">
                            {% for comment in comments %}
                                <li class="bg-white border-l-4 border-orange-400 p-4 rounded-lg shadow-sm hover:shadow-md transition">
                                    <div class="flex justify-between items-center mb-2">
                                        <h3 class="text-lg font-semibold text-orange-800">
                                            {{ comment.candidate.name }}
                                            <span class="text-sm text-gray-500 font-normal ml-1">({{ comment.candidate.phone }})</span>
                                        </h3>
                                        <span class="text-xs text-gray-500">{{ comment.timestamp|date:"d M Y, H:i" }}</span>
                                    </div>
                                    <div class="text-sm text-gray-700 mb-1 space-x-2">
                                        <span class="font-medium text-indigo-800">👤 Volunteer:</span>
                                        {% if comment.candidate.assigned_volunteer %}
                                            {{ comment.candidate.assigned_volunteer.name }}
                                        {% else %}
                                            <span class="italic text-gray-400">Not Assigned</span>
                                        {% endif %}
                                        |
                                        <span class="font-medium text-indigo-800">📊 Status:</span>
                                        {% if comment.candidate.follow_up_status %}
                                            {{ comment.candidate.follow_up_status }}
                                        {% else %}
                                            <span class="italic text-gray-400">N/A</span>
                                        {% endif %}
                                    </div>
                                    <p class="mt-2 text-gray-800 leading-relaxed">{{ comment.content }}</p>
                                </li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
            {% endwith %}
        {% endfor %}
    {% else %}
        <p class="text-center text-orange-600 text-lg italic mt-12">🙏 No comments available right now.</p>
    {% endif %}
</div>

<!-- Toggle JS -->
<script>
    function toggleComments(id) {
        const el = document.getElementById(id);
        if (el) {
            el.classList.toggle('hidden');
        }
    }
</script>
{% endblock %}

