{% extends 'core/base.html' %}

{% block content %}
<div class="container mx-auto p-6 bg-gradient-to-br from-orange-50 via-white to-yellow-50 rounded-xl shadow">
    <h2 class="text-3xl font-bold mb-6 text-yellow-900 text-center">üìù Candidate Comments</h2>

    {% if grouped_comments %}
        {% for date, comments in grouped_comments.items %}
            {% comment %} Calculate follow-up status counts {% endcomment %}
            {% with interested=0 not_interested=0 follow_up_later=0 other=0 %}
                {% for comment in comments %}
                    {% if comment.candidate.follow_up_status == "Interested" %}
                        {% with interested=interested|add:1 %}{% endwith %}
                    {% elif comment.candidate.follow_up_status == "Not Interested" %}
                        {% with not_interested=not_interested|add:1 %}{% endwith %}
                    {% elif comment.candidate.follow_up_status == "Follow-up Later" %}
                        {% with follow_up_later=follow_up_later|add:1 %}{% endwith %}
                    {% else %}
                        {% with other=other|add:1 %}{% endwith %}
                    {% endif %}
                {% endfor %}

                <div class="mb-6 border border-yellow-300 rounded-lg shadow-md bg-yellow-100">
                    <!-- Toggle Header -->
                    <button 
                        class="w-full text-left px-4 py-3 flex justify-between items-center bg-yellow-200 hover:bg-yellow-300 rounded-t-lg"
                        onclick="toggleComments('comments-{{ forloop.counter }}')"
                    >
                        <span class="text-xl font-semibold text-indigo-900">
                            {{ date }}
                        </span>
                        <span class="text-sm text-orange-700">
                            Total Comments: {{ comments|length }} |
                            Interested: {{ interested }} |
                            Not Interested: {{ not_interested }} |
                            Follow-up Later: {{ follow_up_later }} |
                            Others: {{ other }}
                        </span>
                    </button>

                    <!-- Comments Container -->
                    <div id="comments-{{ forloop.counter }}" class="hidden px-4 pb-4">
                        <ul class="space-y-4 mt-4">
                            {% for comment in comments %}
                                <li class="bg-white rounded-lg shadow p-4 border border-orange-200">
                                    <div class="text-base font-bold text-yellow-900">
                                        {{ comment.candidate.name }}
                                        <span class="text-sm text-gray-500">({{ comment.candidate.phone }})</span>
                                    </div>
                                    <div class="text-sm text-gray-700">
                                        Volunteer:
                                        {% if comment.candidate.assigned_volunteer %}
                                            <span class="font-semibold text-indigo-800">{{ comment.candidate.assigned_volunteer.name }}</span>
                                        {% else %}
                                            <span class="italic text-gray-400">Not Assigned</span>
                                        {% endif %}
                                        &nbsp;|&nbsp;
                                        Status:
                                        {% if comment.candidate.follow_up_status %}
                                            <span class="font-semibold text-indigo-800">{{ comment.candidate.follow_up_status }}</span>
                                        {% else %}
                                            <span class="italic text-gray-400">N/A</span>
                                        {% endif %}
                                    </div>
                                    <div class="mt-2 text-gray-800">{{ comment.content }}</div>
                                    <div class="text-xs text-gray-500 mt-1">{{ comment.timestamp|date:"d M Y H:i" }}</div>
                                </li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
            {% endwith %}
        {% endfor %}
    {% else %}
        <p class="text-orange-700 italic text-center">No comments available.</p>
    {% endif %}
</div>

<!-- Simple JS for toggle -->
<script>
    function toggleComments(id) {
        const section = document.getElementById(id);
        section.classList.toggle('hidden');
    }
</script>
{% endblock %}

{% comment %} {% extends 'core/base.html' %}

{% block content %}
<div class="container mx-auto p-6 bg-gradient-to-br from-orange-50 via-white to-yellow-50 rounded-xl shadow">
    <h2 class="text-3xl font-bold mb-6 text-yellow-900 text-center">üìù Candidate Comments</h2>

    {% if grouped_comments %}
        {% for date, comments in grouped_comments.items %}
            <div class="mb-6 border border-yellow-300 rounded-lg shadow-md bg-yellow-100">
                <!-- Toggle Header -->
                <button 
                    class="w-full text-left px-4 py-3 flex justify-between items-center bg-yellow-200 hover:bg-yellow-300 rounded-t-lg"
                    onclick="toggleComments('comments-{{ forloop.counter }}')"
                >
                    <span class="text-xl font-semibold text-indigo-900">
                        {{ date }}
                    </span>
                    <span class="text-sm text-orange-700">Total Comments: {{ comments|length }}</span>
                </button>

                <!-- Comments Container -->
                <div id="comments-{{ forloop.counter }}" class="hidden px-4 pb-4">
                    <ul class="space-y-4 mt-4">
                        {% for comment in comments %}
                            <li class="bg-white rounded-lg shadow p-4 border border-orange-200">
                                <div class="text-base font-bold text-yellow-900">
                                    {{ comment.candidate.name }}
                                    <span class="text-sm text-gray-500">({{ comment.candidate.phone }})</span>
                                </div>
                                <div class="text-sm text-gray-700">
                                    Volunteer:
                                    {% if comment.candidate.assigned_volunteer %}
                                        <span class="font-semibold text-indigo-800">{{ comment.candidate.assigned_volunteer.name }}</span>
                                    {% else %}
                                        <span class="italic text-gray-400">Not Assigned</span>
                                    {% endif %}
                                    &nbsp;|&nbsp;
                                    Status:
                                    {% if comment.candidate.follow_up_status %}
                                        <span class="font-semibold text-indigo-800">{{ comment.candidate.follow_up_status }}</span>
                                    {% else %}
                                        <span class="italic text-gray-400">N/A</span>
                                    {% endif %}
                                </div>
                                <div class="mt-2 text-gray-800">{{ comment.comment }}</div>
                                <div class="text-xs text-gray-500 mt-1">{{ comment.created_at|date:"d M Y H:i" }}</div>
                            </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        {% endfor %}
    {% else %}
        <p class="text-orange-700 italic text-center">No comments available.</p>
    {% endif %}
</div>

<!-- Simple JS for toggle -->
<script>
    function toggleComments(id) {
        const section = document.getElementById(id);
        section.classList.toggle('hidden');
    }
</script>
{% endblock %} {% endcomment %}







{% comment %} {% extends 'core/base.html' %}

{% block content %}
<div class="container mx-auto p-6">
    <h2 class="text-3xl font-bold mb-6 text-blue-900">üìù Candidate Comments</h2>

    {% if grouped_comments %}
        {% for date, comments in grouped_comments.items %}
            <div class="mb-6 border border-blue-200 rounded-lg shadow-md bg-blue-50">
                <!-- Toggle Header -->
                <button 
                    class="w-full text-left px-4 py-3 flex justify-between items-center bg-blue-100 hover:bg-blue-200 rounded-t-lg"
                    onclick="toggleComments('comments-{{ forloop.counter }}')"
                >
                    <span class="text-xl font-semibold text-blue-800">
                        {{ date }}
                    </span>
                    <span class="text-sm text-gray-600">Total Comments: {{ comments|length }}</span>
                </button>

                <!-- Comments Container -->
                <div id="comments-{{ forloop.counter }}" class="hidden px-4 pb-4">
                    <ul class="space-y-4 mt-4">
                        {% for comment in comments %}
                            <li class="bg-white rounded-lg shadow p-4 border border-gray-200">
                                <div class="text-base font-bold text-blue-700">
                                    {{ comment.candidate.name }}
                                    <span class="text-sm text-gray-500">({{ comment.candidate.phone }})</span>
                                </div>
                                <div class="text-sm text-gray-600">
                                    Volunteer:
                                    {% if comment.candidate.assigned_volunteer %}
                                        <span class="font-semibold">{{ comment.candidate.assigned_volunteer.name }}</span>
                                    {% else %}
                                        <span class="italic text-gray-400">Not Assigned</span>
                                    {% endif %}
                                    &nbsp;|&nbsp;
                                    Status:
                                    {% if comment.candidate.follow_up_status %}
                                        <span class="font-semibold">{{ comment.candidate.follow_up_status }}</span>
                                    {% else %}
                                        <span class="italic text-gray-400">N/A</span>
                                    {% endif %}
                                </div>
                                <div class="mt-2 text-gray-800">{{ comment.comment }}</div>
                                <div class="text-xs text-gray-500 mt-1">{{ comment.created_at|date:"d M Y H:i" }}</div>
                            </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        {% endfor %}
    {% else %}
        <p class="text-gray-500 italic">No comments available.</p>
    {% endif %}
</div>

<!-- Simple JS for toggle -->
<script>
    function toggleComments(id) {
        const section = document.getElementById(id);
        if (section.classList.contains('hidden')) {
            section.classList.remove('hidden');
        } else {
            section.classList.add('hidden');
        }
    }
</script>
{% endblock %} {% endcomment %}
{% comment %} {% extends 'core/base.html' %}

{% block content %}
<div class="container mx-auto p-6">
    <h2 class="text-3xl font-bold mb-6 text-blue-900">üìù Candidate Comments</h2>

    {% if grouped_comments %}
        {% for date, comments in grouped_comments.items %}
            <div class="mb-10 border border-blue-200 rounded-lg shadow-md bg-blue-50 p-4">
                <h3 class="text-xl font-semibold text-blue-800 mb-2">{{ date }}</h3>
                <p class="text-sm text-gray-600 mb-4">Total Comments: {{ comments|length }}</p>
                <ul class="space-y-4">
                    {% for comment in comments %}
                        <li class="bg-white rounded-lg shadow p-4 border border-gray-200">
                            <div class="text-base font-bold text-blue-700">
                                {{ comment.candidate.name }} 
                                <span class="text-sm text-gray-500">({{ comment.candidate.phone }})</span>
                            </div>
                            <div class="text-sm text-gray-600">
                                Volunteer: 
                                {% if comment.candidate.assigned_volunteer %}
                                    <span class="font-semibold">{{ comment.candidate.assigned_volunteer.name }}</span>
                                {% else %}
                                    <span class="italic text-gray-400">Not Assigned</span>
                                {% endif %}
                                &nbsp;|&nbsp;
                                Status: 
                                {% if comment.candidate.follow_up_status %}
                                    <span class="font-semibold">{{ comment.candidate.follow_up_status }}</span>
                                {% else %}
                                    <span class="italic text-gray-400">N/A</span>
                                {% endif %}
                            </div>
                            <div class="mt-2 text-gray-800">{{ comment.comment }}</div>
                            <div class="text-xs text-gray-500 mt-1">{{ comment.created_at|date:"d M Y H:i" }}</div>
                        </li>
                    {% endfor %}
                </ul>
            </div>
        {% endfor %}
    {% else %}
        <p class="text-gray-500 italic">No comments available.</p>
    {% endif %}
</div>
{% endblock %} {% endcomment %}


{% comment %} {% extends 'core/base.html' %}
{% block content %}
<h2 class="text-3xl font-bold mb-6 text-blue-800">üìù Candidate Comments</h2>

{% for date, comments in grouped_comments.items %}
  <div class="mb-6 bg-white shadow rounded-lg p-4">
    <h3 class="text-xl font-semibold text-blue-700 mb-3">{{ date }}</h3>
    <ul class="space-y-2">
      {% for comment in comments %}
        <li class="border-l-4 border-blue-500 pl-4 bg-blue-50 p-2 rounded">
          <p><span class="font-semibold text-gray-700">Candidate:</span> {{ comment.candidate.name }}</p>
          <p><span class="font-semibold text-gray-700">Volunteer:</span> {{ comment.volunteer.username }}</p>
          <p><span class="font-semibold text-gray-700">Status:</span> {{ comment.text }}</p>
        </li>
      {% endfor %}
    </ul>
  </div>
{% empty %}
  <p class="text-gray-500">No comments available.</p>
{% endfor %}
{% endblock %} {% endcomment %}
